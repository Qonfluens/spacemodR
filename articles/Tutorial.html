<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial • spacemodR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spacemodR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Tutorial.html">Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/Using_External_Dispersal.html">Using_External_Dispersal</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial</h1>
            
      

      <div class="d-none name"><code>Tutorial.Rmd</code></div>
    </div>

    
    
<p>First step is load the package <code>spacemodR</code>.</p>
<p>You can install from CRAN or from the <a href="https://github.com/Qonfluens/spacemodR" class="external-link">github repository</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spacemodR</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-habitat-layers-in-the-region-of-interest-roi">Load habitat layers in the Region Of Interest (ROI)<a class="anchor" aria-label="anchor" href="#load-habitat-layers-in-the-region-of-interest-roi"></a>
</h2>
<p>The following examples are given for a specific French situation. The
methods are designed to be updated for other countries.</p>
<p>For new regions, new layers or new features, feel free to open an
issue at this link: <a href="https://github.com/Qonfluens/spacemodR/issues" class="external-link">issue link</a>.</p>
<div class="section level3">
<h3 id="set-french-departments">Set French Departments<a class="anchor" aria-label="anchor" href="#set-french-departments"></a>
</h3>
<p>The <code>get_departements_for_roi</code> function identifies the
codes of French departments that intersect with a given Region of
Interest (ROI). This is particularly useful for spatial analyses in
France, where administrative boundaries (like departments) are often
needed to fetch or process geospatial data.</p>
<ul>
<li>
<code>roi</code>: An <code>sf</code> or <code>sfc</code> object
representing your region of interest. The function uses only the first
geometry (polygon) in the object.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"roi_metaleurop"</span><span class="op">)</span></span>
<span><span class="co">## Or load a ROI via geojson</span></span>
<span><span class="co"># roi_metaleurop &lt;- sf::st_read("data/metaleurop_roi.geojson")</span></span>
<span><span class="va">dpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_departements_for_roi.html">get_departements_for_roi</a></span><span class="op">(</span><span class="va">roi_metaleurop</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-ocs-ge-layers-in-the-region-of-interest-roi">Load OCS-GE layers in the Region Of Interest (ROI)<a class="anchor" aria-label="anchor" href="#load-ocs-ge-layers-in-the-region-of-interest-roi"></a>
</h3>
<p>The <code>get_ocsge_data</code> function is designed to download,
extract, and prepare OCS GE (Occupation du Sol à Grande Échelle) version
2 datasets for a specific Region of Interest (ROI).</p>
<p>This function automates the process of fetching spatial data from the
French National Geographic Institute (IGN), merging data from all
relevant departments, and cropping the result to match the boundaries of
your ROI.</p>
<p>Input Parameters:</p>
<ul>
<li>
<code>roi</code>: An <code>sf</code> object (simple features)
defining your region of interest. Only the first feature in the object
is used.</li>
<li>
<code>local_cache</code> (optional): A directory path where
downloaded archives are stored. If not provided, a temporary directory
is used.</li>
</ul>
<p>The function ensures that the ROI is transformed into the Lambert-93
projection (EPSG:2154), which is the standard coordinate system for
French geographic data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This function is long to compute so we load the data set</span></span>
<span><span class="co"># sf_site &lt;- get_ocsge_data(roi_metaleurop)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ocsge_metaleurop</span><span class="op">)</span></span></code></pre></div>
<p>You can then plot the object using for instance the
<code>ggplot2</code> library which is not included in
<code>spacemodR</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ocsge_metaleurop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">code_cs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">roi_metaleurop</span>, fill<span class="op">=</span><span class="cn">NA</span>, color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/vizualize_metaleurop_roi-1.png" class="r-plt" alt="" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="build-a-spacemodel">Build a spacemodel<a class="anchor" aria-label="anchor" href="#build-a-spacemodel"></a>
</h2>
<div class="section level3">
<h3 id="prepare-raster_stack-a-stack-of-raster-for-ground-and-habitats-">Prepare <code>raster_stack</code>: a stack of raster for ground and
habitats.<a class="anchor" aria-label="anchor" href="#prepare-raster_stack-a-stack-of-raster-for-ground-and-habitats-"></a>
</h3>
<div class="section level4">
<h4 id="setting-habitat-from-shapefiles-vector-maps">Setting habitat from shapefiles (vector maps)<a class="anchor" aria-label="anchor" href="#setting-habitat-from-shapefiles-vector-maps"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer_CS2111</span> <span class="op">=</span> <span class="va">ocsge_metaleurop</span><span class="op">[</span><span class="va">ocsge_metaleurop</span><span class="op">$</span><span class="va">code_cs</span> <span class="op">==</span> <span class="st">"CS2.1.1.1"</span>, <span class="op">]</span></span>
<span><span class="va">layer_CS221</span> <span class="op">=</span> <span class="va">ocsge_metaleurop</span><span class="op">[</span><span class="va">ocsge_metaleurop</span><span class="op">$</span><span class="va">code_cs</span> <span class="op">==</span> <span class="st">"CS2.2.1"</span>, <span class="op">]</span></span>
<span><span class="va">layer_CS1121</span> <span class="op">=</span> <span class="va">ocsge_metaleurop</span><span class="op">[</span><span class="va">ocsge_metaleurop</span><span class="op">$</span><span class="va">code_cs</span> <span class="op">==</span> <span class="st">"CS1.1.2.1"</span>, <span class="op">]</span></span></code></pre></div>
<p>The <code>habitat</code> function creates a spatial habitat object,
which inherits from both <code>sf</code> and <code>data.frame</code>
classes.</p>
<p>This object is designed to represent habitat zones and includes
specific attributes: a <code>habitat</code> column (logical, indicating
the presence or absence of habitat), a <code>weight</code> column
(numeric, representing relative importance or weight), and a
<code>geometry</code> column (containing spatial geometries).</p>
<p>If no geometry is provided, the function creates an empty object. It
also performs checks to ensure that the lengths of the habitat and
weight vectors match the number of geometries and that their types are
correct (logical for habitat, numeric for weight).</p>
<p>This function is useful for initializing spatial analyses where
distinguishing between habitat and non-habitat zones is essential.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_10</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="va">layer_CS2111</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">habitat_10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_plot_habitat_10-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_11</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="va">layer_CS2111</span>, weight<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">habitat_11</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 697049.4 ymin: 7032094 xmax: 709595.3 ymax: 7043419</span></span>
<span><span class="co">#&gt; Projected CRS: RGF93 v1 / Lambert-93</span></span>
<span><span class="co">#&gt;   habitat weight                       geometry</span></span>
<span><span class="co">#&gt; 1    TRUE    0.2 MULTIPOLYGON (((697891.4 70...</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_12</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span></span>
<span>  <span class="va">layer_CS2111</span>,</span>
<span>  habitat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">layer_CS2111</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">layer_CS2111</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">habitat_12</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_plot_habitat_12-1.png" class="r-plt" alt="" width="960"></p>
<p>Another option more convenient use of the function for more complex
situation, an idea is the use the function <code>add_habitat</code>.</p>
<p>The <code>add_habitat</code> function is a generic method that adds
habitat zones to an existing habitat object. It takes as input a hab
object of class habitat, an <code>sf</code> object <code>sf_data</code>
containing the geometries to add, and an optional weight parameter
(defaulting to 1) to assign weights to the new geometries. The function
checks that <code>sf_data</code> is indeed an <code>sf</code> object,
then creates a temporary habitat object with the geometries to be added,
marking them as habitat (<code>habitat = TRUE</code>).</p>
<p>If the initial <code>hab</code> object is empty, the new object
becomes the result. Otherwise, the two objects are merged using
<code>dplyr::bind_rows</code>, while preserving the habitat class. This
function is particularly useful for dynamically expanding habitat zones
in a spatial analysis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_20</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_habitat.html">add_habitat</a></span><span class="op">(</span><span class="va">layer_CS2111</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">habitat_20</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "habitat"    "sf"         "data.frame"</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_21</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_habitat.html">add_habitat</a></span><span class="op">(</span><span class="va">layer_CS2111</span>, weight<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">habitat_21</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 697049.4 ymin: 7032094 xmax: 709595.3 ymax: 7043419</span></span>
<span><span class="co">#&gt; Projected CRS: RGF93 v1 / Lambert-93</span></span>
<span><span class="co">#&gt;   habitat weight                       geometry</span></span>
<span><span class="co">#&gt; 1    TRUE    0.2 MULTIPOLYGON (((697891.4 70...</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_22</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_habitat.html">add_habitat</a></span><span class="op">(</span><span class="va">layer_CS2111</span>, weight<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_habitat.html">add_habitat</a></span><span class="op">(</span><span class="va">layer_CS1121</span>, weight<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_nohabitat.html">add_nohabitat</a></span><span class="op">(</span><span class="va">layer_CS221</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">habitat_22</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 3 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 695704.7 ymin: 7031268 xmax: 709595.3 ymax: 7043983</span></span>
<span><span class="co">#&gt; Projected CRS: RGF93 v1 / Lambert-93</span></span>
<span><span class="co">#&gt;   habitat weight                       geometry</span></span>
<span><span class="co">#&gt; 1    TRUE    0.2 MULTIPOLYGON (((697891.4 70...</span></span>
<span><span class="co">#&gt; 2    TRUE    0.4 MULTIPOLYGON (((698440.6 70...</span></span>
<span><span class="co">#&gt; 3   FALSE    0.0 MULTIPOLYGON (((698052.4 70...</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">habitat_22</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot_habitat_22-1.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level4">
<h4 id="what-is-an-habitat">/! WHAT IS AN HABITAT<a class="anchor" aria-label="anchor" href="#what-is-an-habitat"></a>
</h4>
<p>What we consider <code>habitat</code> is defined by the purpose of
the model.</p>
<p>There is 3 situations: 1. the area where the species cannot go, even
just passing (impossible)</p>
<p>A raster of</p>
</div>
<div class="section level4">
<h4 id="defining-raster-of-habitat-based-on-a-raster-of-the-ground">Defining raster of habitat based on a raster of the ground<a class="anchor" aria-label="anchor" href="#defining-raster-of-habitat-based-on-a-raster-of-the-ground"></a>
</h4>
<p>Here, we download a raster layer with the interpolation of the ground
concentration of cadmium.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the raster tif file is internal to the spacemodR package</span></span>
<span><span class="va">ground_cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_raster_extdata.html">load_raster_extdata</a></span><span class="op">(</span><span class="st">"ground_concentration_cd_compressed.tif"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ground_cd</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/load_ground_cd-1.png" class="r-plt" alt="" width="960"></p>
<p>Then, it’s the same algorithm to specified habitat and then build
rasters.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a list of OSGE code to make life easier</span></span>
<span><span class="va">OCSGE_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  forest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CS2.1.1.1"</span>, <span class="st">"CS2.1.1.2"</span>, <span class="st">"CS2.1.1.3"</span>, <span class="st">"CS2.1.3"</span><span class="op">)</span>,</span>
<span>  grass <span class="op">=</span> <span class="st">"CS2.2.1"</span>,</span>
<span>  water <span class="op">=</span> <span class="st">"CS1.2.2"</span>,</span>
<span>  soil <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CS1.2.1"</span>,<span class="st">"CS2.1.1.1"</span>,<span class="st">"CS2.1.1.2"</span>,<span class="st">"CS2.1.1.3"</span>,</span>
<span>           <span class="st">"CS2.1.2"</span>,<span class="st">"CS2.1.3"</span>,<span class="st">"CS2.2.1"</span>,<span class="st">"CS2.2.3"</span><span class="op">)</span>,</span>
<span>  sealed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CS1.1.1.1"</span>, <span class="st">"CS1.1.1.2"</span>, <span class="st">"CS1.1.2.1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer_soil_natural</span> <span class="op">=</span> <span class="va">ocsge_metaleurop</span><span class="op">[</span><span class="va">ocsge_metaleurop</span><span class="op">$</span><span class="va">code_cs</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">OCSGE_codes</span><span class="op">$</span><span class="va">soil</span>, <span class="op">]</span></span>
<span><span class="va">layer_soil_artificial</span> <span class="op">=</span> <span class="va">ocsge_metaleurop</span><span class="op">[</span><span class="va">ocsge_metaleurop</span><span class="op">$</span><span class="va">code_cs</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">OCSGE_codes</span><span class="op">$</span><span class="va">sealed</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">habitat_sol</span> <span class="op">=</span> <span class="fu"><a href="../reference/habitat.html">habitat</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_habitat.html">add_habitat</a></span><span class="op">(</span><span class="va">layer_soil_natural</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_nohabitat.html">add_nohabitat</a></span><span class="op">(</span><span class="va">layer_soil_artificial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">habitat_sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_habitat_sol-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rast_sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/habitat_raster.html">habitat_raster</a></span><span class="op">(</span><span class="va">ground_cd</span>, <span class="va">habitat_sol</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rast_sol</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_raster_habitat-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rast_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/habitat_raster.html">habitat_raster</a></span><span class="op">(</span><span class="va">ground_cd</span>, <span class="va">habitat_10</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rast_10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_raster_habitat-2.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rast_12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/habitat_raster.html">habitat_raster</a></span><span class="op">(</span><span class="va">ground_cd</span>, <span class="va">habitat_12</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rast_12</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_raster_habitat-3.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rast_22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/habitat_raster.html">habitat_raster</a></span><span class="op">(</span><span class="va">ground_cd</span>, <span class="va">habitat_22</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rast_22</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_raster_habitat-4.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level4">
<h4 id="join-all-rasters-with-a-single-stack">Join all rasters with a single stack<a class="anchor" aria-label="anchor" href="#join-all-rasters-with-a-single-stack"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stack_habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/raster_stack.html">raster_stack</a></span><span class="op">(</span></span>
<span>  raster_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rast_sol</span>, <span class="va">rast_10</span>, <span class="va">rast_12</span>, <span class="va">rast_22</span><span class="op">)</span>,</span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sol"</span>, <span class="st">"sp10"</span>, <span class="st">"sp12"</span>, <span class="st">"sp22"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stack_habitat</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/build_stack_raster_habitat-1.png" class="r-plt" alt="" width="960"></p>
</div>
</div>
<div class="section level3">
<h3 id="prepare-trophic_df-a-data-frame-of-trophic-web">Prepare <code>trophic_df</code>: a <code>data.frame</code> of
trophic web<a class="anchor" aria-label="anchor" href="#prepare-trophic_df-a-data-frame-of-trophic-web"></a>
</h3>
<p>You can use a data.frame like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sol"</span>, <span class="st">"sol"</span>, <span class="st">"sp10"</span>, <span class="st">"sp12"</span><span class="op">)</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp10"</span>, <span class="st">"sp12"</span>, <span class="st">"sp12"</span>, <span class="st">"sp22"</span><span class="op">)</span>,</span>
<span>  w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trophic_from_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trophic.html">trophic</a></span><span class="op">(</span><span class="va">df_raw</span>, from <span class="op">=</span> <span class="st">"src"</span>, to <span class="op">=</span> <span class="st">"target"</span>, weight <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">trophic_from_df</span>, <span class="st">"level"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  sol sp10 sp12 sp22 </span></span>
<span><span class="co">#&gt;    1    2    3    4</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trophic_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trophic.html">trophic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"sol"</span>, <span class="st">"sp10"</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"sol"</span>, <span class="st">"sp12"</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"sp10"</span>, <span class="st">"sp12"</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"sp12"</span>, <span class="st">"sp22"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">trophic_df</span>, <span class="st">"level"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  sol sp10 sp12 sp22 </span></span>
<span><span class="co">#&gt;    1    2    3    4</span></span></code></pre></div>
<p>The trophic web can then be computed:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trophic_df</span>, shift<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot_trophic_web_df_noshift-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trophic_df</span>, shift<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot_trophic_web_df_shift-1.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level3">
<h3 id="spacemodel-merge-a-stack-of-rasters-with-a-trophic-web-linking-rasters">Spacemodel: merge a stack of rasters with a trophic web linking
rasters<a class="anchor" aria-label="anchor" href="#spacemodel-merge-a-stack-of-rasters-with-a-trophic-web-linking-rasters"></a>
</h3>
<p>A <code>spacemodel</code> is a list of two object a raster_stack and
a trophic_graph: - the <code>raster_stack</code> is a stack of rasters
using the <code>terra</code> package and the object
<code>raster_stack</code> - the <code>trophic_graph</code> is a directed
acyclic graph (DAG) to which we can add <code>weight</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spcmdl_habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spacemodel.html">spacemodel</a></span><span class="op">(</span><span class="va">stack_habitat</span>, <span class="va">trophic_df</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">color_habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#169E19"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">255</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_habitat</span>, col<span class="op">=</span><span class="va">color_habitat</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="spacemodel-for-dispersal">Spacemodel for Dispersal<a class="anchor" aria-label="anchor" href="#spacemodel-for-dispersal"></a>
</h2>
<p>Dispersal is independent of trophic link for now since we did not yet
implemented a dispersal dependent of the potential trophic links.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k_sp10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_kernel.html">compute_kernel</a></span><span class="op">(</span>radius<span class="op">=</span><span class="fl">10</span>, GSD<span class="op">=</span><span class="fl">25</span>, size_std<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">k_sp12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_kernel.html">compute_kernel</a></span><span class="op">(</span>radius<span class="op">=</span><span class="fl">100</span>, GSD<span class="op">=</span><span class="fl">25</span>, size_std<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">k_sp22</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_kernel.html">compute_kernel</a></span><span class="op">(</span>radius<span class="op">=</span><span class="fl">200</span>, GSD<span class="op">=</span><span class="fl">25</span>, size_std<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spcmdl_dispersal</span> <span class="op">&lt;-</span> <span class="va">spcmdl_habitat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/dispersal.html">dispersal</a></span><span class="op">(</span><span class="st">"sp10"</span>,  method<span class="op">=</span><span class="st">"convolution"</span>,  method_option<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kernel<span class="op">=</span><span class="va">k_sp10</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/dispersal.html">dispersal</a></span><span class="op">(</span><span class="st">"sp12"</span>,  method<span class="op">=</span><span class="st">"convolution"</span>,  method_option<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kernel<span class="op">=</span><span class="va">k_sp12</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/dispersal.html">dispersal</a></span><span class="op">(</span><span class="st">"sp22"</span>,  method<span class="op">=</span><span class="st">"convolution"</span>,  method_option<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kernel<span class="op">=</span><span class="va">k_sp22</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plot the dispersal object:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">color_dispersal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#166C9E"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">255</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_dispersal</span>, col<span class="op">=</span><span class="va">color_dispersal</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/plot_spacemodel_dispersal-1.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level2">
<h2 id="spacemodel-for-exposure">Spacemodel for Exposure<a class="anchor" aria-label="anchor" href="#spacemodel-for-exposure"></a>
</h2>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spcmdl_dispersal</span><span class="op">[[</span><span class="st">"sol"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ground_cd</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_dispersal</span><span class="op">[[</span><span class="st">"sol"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/exposure_set_ground_cd-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kernels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  sol  <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  sp10 <span class="op">=</span> <span class="va">k_sp10</span>,</span>
<span>  sp12 <span class="op">=</span> <span class="va">k_sp12</span>,</span>
<span>  sp22 <span class="op">=</span> <span class="va">k_sp22</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">spcmdl_dispersal</span>, <span class="st">"trophic_tbl"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             link weight</span></span>
<span><span class="co">#&gt; sp10   sol, sp10      2</span></span>
<span><span class="co">#&gt; sp12   sol, sp12      3</span></span>
<span><span class="co">#&gt; sp121 sp10, sp12      2</span></span>
<span><span class="co">#&gt; sp22  sp12, sp22      1</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_intakes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/intake.html">intake</a></span><span class="op">(</span><span class="va">spcmdl_dispersal</span>,</span>
<span>  <span class="co"># General rule: sp12 uptake with factor 3</span></span>
<span>  <span class="st">"sp12"</span> <span class="op">=</span> <span class="fl">3</span>,  </span>
<span>  <span class="co"># Exception: when sp12 feed on sp10, factor is 5</span></span>
<span>  <span class="st">"sp10 -&gt; sp12"</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="co"># General rule: sp22 has a complex function</span></span>
<span>  <span class="st">"sp22"</span> <span class="op">=</span> <span class="op">~</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>  <span class="co"># Exception: sol to sp10 is a coef</span></span>
<span>  <span class="st">"sol -&gt; sp10"</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  default <span class="op">=</span> <span class="fl">1</span> <span class="co"># for all other default is 1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">spcmdl_transfer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transfer.html">transfer</a></span><span class="op">(</span><span class="va">spcmdl_dispersal</span>, <span class="va">kernels</span>, <span class="va">test_intakes</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">color_transfer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#A33D0A"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">255</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_transfer</span>, col<span class="op">=</span><span class="va">color_transfer</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/exposure_spacemodel_plot-1.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level2">
<h2 id="eco-ssl-example-build-a-spacemodel-for-eco-ssl">Eco-SSL Example: Build a <code>spacemodel</code> for Eco-SSL<a class="anchor" aria-label="anchor" href="#eco-ssl-example-build-a-spacemodel-for-eco-ssl"></a>
</h2>
<p>The first step is to build a raster stack with the ground as
raster.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ground_cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_raster_extdata.html">load_raster_extdata</a></span><span class="op">(</span><span class="st">"ground_concentration_cd_compressed.tif"</span><span class="op">)</span></span>
<span><span class="va">names_hab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"plant"</span>, <span class="st">"invert"</span>, <span class="st">"mamHerb"</span>, <span class="st">"mamInsect"</span>, <span class="st">"birdInsect"</span><span class="op">)</span></span>
<span><span class="va">list_habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">names_hab</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">ground_cd</span><span class="op">)</span></span>
<span><span class="va">stack_habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/raster_stack.html">raster_stack</a></span><span class="op">(</span><span class="va">list_habitat</span>, <span class="va">names_hab</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stack_habitat</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/eco_ssl_cd_habitat-1.png" class="r-plt" alt="" width="960"></p>
<p>The second step is to build the trophic web, all species connecting
directly to the soil.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trophic_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trophic.html">trophic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"plant"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"invert"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"mamHerb"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"mamInsect"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span><span class="st">"soil"</span>, <span class="st">"birdInsect"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">trophic_df</span>, <span class="st">"level"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       soil      plant     invert    mamHerb  mamInsect birdInsect </span></span>
<span><span class="co">#&gt;          1          2          2          2          2          2</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trophic_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/eco_ssl_cd_trophic_plot-1.png" class="r-plt" alt="" width="960"></p>
<p>The third step is to merge the raster stack with the trophic
data.frame.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spcmdl_ecossl_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spacemodel.html">spacemodel</a></span><span class="op">(</span><span class="va">stack_habitat</span>, <span class="va">trophic_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_h</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/eco_ssl_cd_spacemodel-1.png" class="r-plt" alt="" width="960"></p>
<div class="section level3">
<h3 id="build-the-risk-indice">Build the Risk indice<a class="anchor" aria-label="anchor" href="#build-the-risk-indice"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no dispersal for eco_ssl</span></span>
<span><span class="va">ecossl_kernels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  soil  <span class="op">=</span> <span class="cn">NA</span>, plant <span class="op">=</span> <span class="cn">NA</span>, invert <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  mamHerb <span class="op">=</span> <span class="cn">NA</span>, mamInsect <span class="op">=</span> <span class="cn">NA</span>, birdInsect <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecossl_intakes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/intake.html">intake</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_h</span>,</span>
<span>  <span class="st">"soil -&gt; plant"</span>       <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">/</span><span class="fl">32</span>,  </span>
<span>  <span class="st">"soil -&gt; invert"</span>      <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">/</span><span class="fl">140</span>,</span>
<span>  <span class="st">"soil -&gt; mamHerb"</span>     <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">/</span><span class="fl">73</span>,</span>
<span>  <span class="st">"soil -&gt; mamInsect"</span>   <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">/</span><span class="fl">0.36</span>,</span>
<span>  <span class="st">"soil -&gt; birdInsect"</span>  <span class="op">=</span> <span class="op">~</span> <span class="fl">10</span><span class="op">^</span><span class="va">x</span><span class="op">/</span><span class="fl">0.77</span>,</span>
<span>  default <span class="op">=</span> <span class="fl">1</span>, <span class="co"># for all other default is 1</span></span>
<span>  normalize <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># TRUE would weight every link to sum at 1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spcmdl_ecossl_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transfer.html">transfer</a></span><span class="op">(</span></span>
<span>  <span class="va">spcmdl_ecossl_h</span>,</span>
<span>  <span class="va">ecossl_kernels</span>,</span>
<span>  <span class="va">ecossl_intakes</span>,</span>
<span>  exposure_weighting<span class="op">=</span><span class="st">"potential"</span><span class="op">)</span></span></code></pre></div>
<p>A plot of layer with risk threshold color scale.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Risk colors</span></span>
<span><span class="va">breaks_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">cols_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"darkgreen"</span>,   <span class="co"># 0 - 0.1</span></span>
<span>  <span class="st">"green"</span>,       <span class="co"># 0.1 - 0.5</span></span>
<span>  <span class="st">"lightgreen"</span>,  <span class="co"># 0.5 - 1</span></span>
<span>  <span class="st">"yellow"</span>,      <span class="co"># 1 - 5</span></span>
<span>  <span class="st">"saddlebrown"</span>, <span class="co"># 5 - 10</span></span>
<span>  <span class="st">"#4A2C2A"</span>      <span class="co"># &gt; 10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">names_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_risk</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_risk</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"soil"</span><span class="op">]</span></span>
<span><span class="va">spcmdl_ecossl_risk_sub</span> <span class="op">&lt;-</span> <span class="va">spcmdl_ecossl_risk</span><span class="op">[[</span><span class="va">names_keep</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_risk_sub</span>,</span>
<span>            breaks <span class="op">=</span> <span class="va">breaks_risk</span>,</span>
<span>            col <span class="op">=</span> <span class="va">cols_risk</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/eco_ssl_risk_plot-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly</span> <span class="op">&lt;-</span> <span class="va">roi_metaleurop</span></span>
<span><span class="va">poly_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">poly</span><span class="op">)</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_risk_sub</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rast_crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">spcmdl_ecossl_risk_sub</span>, <span class="va">poly_vect</span><span class="op">)</span></span>
<span><span class="va">rast_final</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">rast_crop</span>, <span class="va">poly_vect</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rast_final</span>,</span>
<span>            breaks <span class="op">=</span> <span class="va">breaks_risk</span>,</span>
<span>            col <span class="op">=</span> <span class="va">cols_risk</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/eco_ssl_risk_plot_crop-1.png" class="r-plt" alt="" width="960"></p>
<div class="section level4">
<h4 id="checking-eco-ssl">checking Eco-SSL<a class="anchor" aria-label="anchor" href="#checking-eco-ssl"></a>
</h4>
<p>For this very simple example, a simple check can be done, because
Eco-SSL is a computing of a risk based on the amount in soil:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_ecossl_risk</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"soil -&gt; plant"</span>       <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">ground_cd</span><span class="op">/</span><span class="fl">32</span>,  </span>
<span>  <span class="st">"soil -&gt; invert"</span>      <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">ground_cd</span><span class="op">/</span><span class="fl">140</span>,</span>
<span>  <span class="st">"soil -&gt; mamHerb"</span>     <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">ground_cd</span><span class="op">/</span><span class="fl">73</span>,</span>
<span>  <span class="st">"soil -&gt; mamInsect"</span>   <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">ground_cd</span><span class="op">/</span><span class="fl">0.36</span>,</span>
<span>  <span class="st">"soil -&gt; birdInsect"</span>  <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="va">ground_cd</span><span class="op">/</span><span class="fl">0.77</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_check_ecossl_risk</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">check_ecossl_risk</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r_check_ecossl_risk</span>,</span>
<span>            breaks <span class="op">=</span> <span class="va">breaks_risk</span>,</span>
<span>            col <span class="op">=</span> <span class="va">cols_risk</span><span class="op">)</span></span></code></pre></div>
<p><img src="Tutorial_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="960"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Virgile Baudrot.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
